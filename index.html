<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Octagram Tesseract Renderer (ND-safe, Offline)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
  <style>
    /* ND-safe: calm contrast, no motion, layered glow to preserve depth without triggering */
    :root {
      --bg:#0b0e18;
      --ink:#f6f2de;
      --muted:#b8b1a0;
      --edge:#1d2539;
    }
    html,body {
      margin:0;
      padding:0;
      background:radial-gradient(circle at 50% 18%, rgba(58,82,122,0.55), var(--bg));
      color:var(--ink);
      font:14px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
    }
    header {
      padding:12px 18px 10px;
      border-bottom:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(25,34,56,0.92), rgba(9,12,22,0.96));
    }
    .status {
      color:var(--muted);
      font-size:12px;
      margin-top:2px;
    }
    #stage {
      display:block;
      margin:20px auto 12px;
      box-shadow:0 0 0 1px var(--edge),0 18px 48px rgba(8,12,22,0.55);
      background-color:transparent;
    }
    .note {
      max-width:920px;
      margin:0 auto 18px;
      color:var(--muted);
      padding:0 16px 18px;
    }
    code {
      background:#13192d;
      padding:2px 4px;
      border-radius:3px;
    }
  </style>
</head>
<body>
  <header>
    <div><strong>Octagram Tesseract Renderer</strong> — layered sacred geometry (offline, ND-safe)</div>
    <div class="status" id="status">Preparing octagram system…</div>
  </header>

  <canvas id="stage" width="1440" height="900" aria-label="Layered octagram tesseract canvas"></canvas>
  <p class="note">Static renderer encoding Vesica field, Tree-of-Life scaffold, Fibonacci arc, and an octagram tesseract lattice with a double helix bridge. No animation, autoplay, or network calls. Open directly from disk.</p>

  <script type="module">
    import { prepareOctagramSystem, renderOctagramTesseract } from "./js/octagram-tesseract.mjs";
    import { disable as disabledSystems } from "./js/tesseract-toggle.js";

    const statusEl = document.getElementById("status");
    const canvas = document.getElementById("stage");
    const ctx = canvas.getContext("2d");

    if (!ctx) {
      statusEl.textContent = "Canvas context unavailable; nothing rendered.";
    } else {
      main().catch((error) => {
        console.error("Octagram init failed", error);
        statusEl.textContent = "Octagram system failed; see console for diagnostics.";
      });
    }

    async function main() {
      const helixDisabled = disabledSystems.has("helix_renderer");
      const prep = await prepareOctagramSystem({
        dims: { width: canvas.width, height: canvas.height },
        palettePaths: ["./data/palettes/tara_21.json", "./data/palette.json"],
        nodesPath: "./data/octagram_tesseract_nodes.json",
        schemaPath: "./schemas/octagram_tesseract.schema.json"
      });

      if (prep.shellNotice) {
        statusEl.textContent = prep.shellNotice;
      } else {
        statusEl.textContent = "Octagram system ready.";
      }

      const renderSummary = renderOctagramTesseract(ctx, prep);
      const infoBits = [];
      if (helixDisabled) infoBits.push("helix renderer disabled");
      if (prep.paletteNotice) infoBits.push(prep.paletteNotice);
      if (prep.validationSummary) infoBits.push(prep.validationSummary);
      if (renderSummary && renderSummary.summary) infoBits.push(renderSummary.summary);
      if (prep.activationSummary) infoBits.push(prep.activationSummary);
      if (infoBits.length > 0) {
        statusEl.textContent = infoBits.join(" · ");
      }
    }
  </script>
</body>
</html>
